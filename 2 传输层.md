# 传输层 TCP, UDP, SCTP

- TCP三路握手
- TCP连接终止序列
- TCP的TIME_WAIT状态
- SCTP四路握手
- SCTP的连接终止
- 套接字层TCP，UDP，SCTP缓冲机制


> BSD分组过滤程序(BPF)是一种软件设备，用于过滤网络接口的数据流，即给网络接口加上开关。
> 数据链路提供者接口(DLPI)：提供对链路层的访问能力，随SVR4内核提供
> XTI

SCTP：可靠的传输协议

## 套接字分类

### 原始套接字
绕过传输层？（原始套接字）
分为 链路层原始套接字 和 网络层原始套接字
主要应用与底层网络编程

> 发送自定义的IP数据包
> 发送ICMP数据包
> 网卡的侦听模式，监听网络上的数据包
> 伪装IP地址
> 自定位协议的实现

-  链路层原始套接字
> 可以直接用于接收和发送链路层MAC帧，在发送时需要由调用者自行构造和封装MAC首部

- 网络层原始套接字
> 网络层原始套接字可以直接用于接收和发送IP层的报文数据
> 操作IP首部或传输层协议首部，就需要调用如下socket()函数创建网络层原始套接字

### 标准套接字

流式套接字和数据报套接字这两种套接字工作在传输层，主要为应用层的应用程序提供服务，并且在接收和发送时只能操作数据部分，而不能对IP首部或TCP和UDP首部进行操作。

原始套接字可以自动组装数据包（伪装本地IP和本地MAC），可以接收本机网卡上所有的数据帧（数据包）。另外，必须在管理员权限下才能使用原始套接字。

- 流式套接字
- 数据包套接字


## UDP，TCP，SCTP

TCP
	流量控制：通告窗口
SCTP
	面向消息的，提供各个记录的按序递送服务


## TCP连接建立

### 三路握手
```
1 server : socket , bind , listen
2 client :
	connect -> 客户端发送一个SYN段：告诉服务器客户将在连接中发送数据的初始序号。
	(connect block)
3 server :
	accept  -> 服务器确认ACK客户的SYN
			-> 服务器自己发送一个SYN段：服务器在这个连接中发送数据的初始序号。
	(accept block)
4 client :
	connect -> 客户端收到服务器的ACK和服务器的SYN，发送一个ACK对服务器的SYN确认
	(connect return)

5 server : 收到SYN
	(accept return)
```

### TCP选项

MSS：使用TCP_MAXSEG套接字选项提取和设置这个TCP选项

### TCP连接终止

```
1 c close -> FIN
2 s EOF->ACK
3 s FIN
4 c ACK
```



## TIME_WAIT

可靠地实现TCP全双工连接的终止

允许老的重复的分节在网络中消逝

为了防止在化身情况下收到之前的TIME_WAIT状态下发送的包，需要等待2MSL时间再建立相同的连接（一个是FIN分组MSL时间后另一个是应答分组经历MSL）



## SCTP关联的建立和终止

### 四路握手

